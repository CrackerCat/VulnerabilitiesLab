CEREAL="/src/cereal/include"


all:  	cve-2020-11104 cve-2020-11105 xml-null-dereference \
	xml-uninit-memory-leak xml-stack-dos json-stack-dos \
	json-uninit-mem-leak memory-bomb null-byte-bug \
	xml-injection json-double-long-dos serialize-double-long

cve-2020-11104: cve-2020-11104.c
	clang++ -o $@ -I$(CEREAL) $?

cve-2020-11105: cve-2020-11105.c
	clang++ -o $@ -I$(CEREAL) $?

xml-null-dereference: xml-null-dereference.c
	clang++ -o $@ -I$(CEREAL) $?

xml-uninit-memory-leak: xml-uninit-memory-leak.c
	clang++ -o $@ -I$(CEREAL) $?

xml-stack-dos: xml-stack-dos.c
	clang++ -o $@ -I$(CEREAL) $?

json-stack-dos: json-stack-dos.c
	clang++ -o $@ -I$(CEREAL) $?

json-uninit-mem-leak: json-uninit-mem-leak.c
	clang++ -o $@ -I$(CEREAL) -fsanitize=address $?

memory-bomb: memory-bomb.c
	clang++ -o $@ -I$(CEREAL) $?

null-byte-bug: null-byte-bug.c
	clang++ -o $@ -I$(CEREAL) $?

xml-injection: xml-injection.c
	clang++ -o $@ -I$(CEREAL) $?

json-double-long-dos: json-double-long-dos.c
	clang++ -o $@ -I$(CEREAL) $?

serialize-double-long: serialize-double-long.c deserialize-double-long.c
	clang++ -o serialize-double-long -I$(CEREAL) serialize-double-long.c
	clang++ -o deserialize-double-long-64 -I$(CEREAL) \
		deserialize-double-long.c
	clang++ -o deserialize-double-long-32 -m32 -I$(CEREAL) \
		deserialize-double-long.c

clean:
	rm -f cve-2020-11104 CVE-2020-11105 xml-null-dereference \
	      	xml-uninit-memory-leak xml-stack-dos json-stack-dos \
		json-uninit-mem-leak memory-bomb null-byte-bug \
		xml-injection json-double-long-dos \
		serialize-double-long \
		deserialize-double-long-64 deserialize-double-long-32 \
		precision.txt
